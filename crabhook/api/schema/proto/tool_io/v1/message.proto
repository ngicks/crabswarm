syntax = "proto3";

package tool_io.v1;

import "tool_io/v1/tool_input.proto";
import "tool_io/v1/other.proto";
import "tool_io/v1/permission.proto";
import "google/protobuf/struct.proto";

// SDKAssistantMessage represents an assistant message in the SDK message stream.
// Copied from https://platform.claude.com/docs/en/agent-sdk/typescript#sdk-assistant-message
message SDKAssistantMessage {
  string uuid = 1;
  string session_id = 2;
  // APIAssistantMessage from the Anthropic SDK.
  google.protobuf.Struct message = 3;
  optional string parent_tool_use_id = 4;
}

// SDKUserMessage represents a user message in the SDK message stream.
// Copied from https://platform.claude.com/docs/en/agent-sdk/typescript#sdk-user-message
message SDKUserMessage {
  optional string uuid = 1;
  string session_id = 2;
  // APIUserMessage from the Anthropic SDK.
  google.protobuf.Struct message = 3;
  optional string parent_tool_use_id = 4;
}

// SDKUserMessageReplay represents a replayed user message.
// Copied from https://platform.claude.com/docs/en/agent-sdk/typescript#sdk-user-message-replay
message SDKUserMessageReplay {
  string uuid = 1;
  string session_id = 2;
  // APIUserMessage from the Anthropic SDK.
  google.protobuf.Struct message = 3;
  optional string parent_tool_use_id = 4;
}

// SDKResultSubtype represents the subtype of a result message.
// Copied from https://platform.claude.com/docs/en/agent-sdk/typescript#sdk-result-message
enum SDKResultSubtype {
  SDK_RESULT_SUBTYPE_UNSPECIFIED = 0;
  SDK_RESULT_SUBTYPE_SUCCESS = 1;
  SDK_RESULT_SUBTYPE_ERROR_MAX_TURNS = 2;
  SDK_RESULT_SUBTYPE_ERROR_DURING_EXECUTION = 3;
  SDK_RESULT_SUBTYPE_ERROR_MAX_BUDGET_USD = 4;
  SDK_RESULT_SUBTYPE_ERROR_MAX_STRUCTURED_OUTPUT_RETRIES = 5;
}

// SDKPermissionDenial represents a permission denial event.
// Copied from https://platform.claude.com/docs/en/agent-sdk/typescript#sdk-result-message
message SDKPermissionDenial {
  string tool_name = 1;
  string tool_use_id = 2;
  ToolInput tool_input = 3;
}

// SDKResultMessage represents the final result of an SDK session.
// Copied from https://platform.claude.com/docs/en/agent-sdk/typescript#sdk-result-message
message SDKResultMessage {
  SDKResultSubtype subtype = 1;
  string uuid = 2;
  string session_id = 3;
  int64 duration_ms = 4;
  int64 duration_api_ms = 5;
  bool is_error = 6;
  int32 num_turns = 7;
  double total_cost_usd = 8;
  NonNullableUsage usage = 9;
  map<string, ModelUsage> model_usage = 10;
  repeated SDKPermissionDenial permission_denials = 11;
  // Success-only fields.
  optional string result = 12;
  optional google.protobuf.Value structured_output = 13;
  // Error-only fields.
  repeated string errors = 14;
}

// SDKSystemMcpServer represents an MCP server in the system message.
// Copied from https://platform.claude.com/docs/en/agent-sdk/typescript#sdk-system-message
message SDKSystemMcpServer {
  string name = 1;
  string status = 2;
}

// SDKSystemMessage represents the system message at session start.
// Copied from https://platform.claude.com/docs/en/agent-sdk/typescript#sdk-system-message
message SDKSystemMessage {
  string uuid = 1;
  string session_id = 2;
  ApiKeySource api_key_source = 3;
  string cwd = 4;
  repeated string tools = 5;
  repeated SDKSystemMcpServer mcp_servers = 6;
  string model = 7;
  PermissionMode permission_mode = 8;
  repeated string slash_commands = 9;
  string output_style = 10;
}

// SDKPartialAssistantMessage represents a partial streaming assistant message.
// Copied from https://platform.claude.com/docs/en/agent-sdk/typescript#sdk-partial-assistant-message
message SDKPartialAssistantMessage {
  string uuid = 1;
  string session_id = 2;
  // RawMessageStreamEvent from the Anthropic SDK.
  google.protobuf.Struct event = 3;
  optional string parent_tool_use_id = 4;
}

// CompactMetadata represents metadata about a compaction event.
// Copied from https://platform.claude.com/docs/en/agent-sdk/typescript#sdk-compact-boundary-message
message CompactMetadata {
  string trigger = 1;
  int32 pre_tokens = 2;
}

// SDKCompactBoundaryMessage represents a compaction boundary in the message stream.
// Copied from https://platform.claude.com/docs/en/agent-sdk/typescript#sdk-compact-boundary-message
message SDKCompactBoundaryMessage {
  string uuid = 1;
  string session_id = 2;
  CompactMetadata compact_metadata = 3;
}

// SDKMessage is a union wrapper for all SDK message types.
// Copied from https://platform.claude.com/docs/en/agent-sdk/typescript#sdk-message
message SDKMessage {
  oneof message {
    SDKAssistantMessage assistant = 1;
    SDKUserMessage user = 2;
    SDKUserMessageReplay user_replay = 3;
    SDKResultMessage result = 4;
    SDKSystemMessage system = 5;
    SDKPartialAssistantMessage partial = 6;
    SDKCompactBoundaryMessage compact_boundary = 7;
  }
}
